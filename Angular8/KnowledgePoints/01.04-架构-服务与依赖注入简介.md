# [返回主目录](Readme.md)

# 目录 <!-- omit in toc --> 
- [返回主目录](#返回主目录)
- [服务与依赖注入简介](#服务与依赖注入简介)
  - [依赖注入(dependency injection)](#依赖注入dependency-injection)
    - [提供服务](#提供服务)


# 服务与依赖注入简介
**服务**是一个广义的概念，它**包括应用所需的任何值、函数或特性**。**狭义的服务**是一个**明确定义了用途的类**。它应该做一些具体的事，并做好。  
Angular 把**组件和服务区分开**，以提高模块性和复用性。   
**组件**的工作**只管用户体验**，而不用顾及其它。  
组件应该把诸如**从服务器获取数据、验证用户输入或直接往控制台中写日志等工作委托给各种服务**。通过把各种处理任务定义到可注入的服务类中，你可以让它被任何组件使用。   
Angular 只会**通过依赖注入来帮你更容易地将应用逻辑分解为服务，并让这些服务可用于各个组件中**。  

## 依赖注入(dependency injection)
![image](images/01.04-架构-服务与依赖注入简介/dependency-injection.png)

**DI** 被融入 Angular 框架中，用于**在任何地方给新建的组件提供服务或所需的其它东西**。 
**组件是服务的消费者**,你可以把一个服务注入到组件中，让组件类得以访问该服务类。

把一个**类定义为服务**，就要用 **@Injectable() 装饰器来提供元数据**，以便让 Angular 可以把它**作为依赖注入到组件**中。 同样，也要使用 @Injectable() 装饰器来表明一个组件或其它类（比如另一个服务、管道或 NgModule）拥有一个依赖。

- **注入器**是主要的机制。Angular 会在启动过程中为你创建全应用级注入器以及所需的其它注入器。你不用自己创建注入器。

- **该注入器会创建依赖、维护一个容器来管理这些依赖**，并尽可能复用它们。

- **提供商**是一个对象，用来**告诉注入器应该如何获取或创建依赖**。  

你的应用中所需的任何依赖，都必须使用该应用的注入器来注册一个提供商，以便注入器可以使用这个提供商来创建新实例。 对于服务，该提供商通常就是服务类本身。  

>**依赖不一定是服务 —— 它还可能是函数或值。**

当 Angular 创建组件类的新实例时，它会通过**查看该组件类的构造函数**，**来决定该组件依赖哪些服务或其它依赖项**。 

```ts
constructor(private service: HeroService) { }
```
当 Angular **发现某个组件依赖某个服务**时，它会**首先检查是否该注入器中已经有了那个服务的任何现有实例**。如果所请求的**服务尚不存在**，注入器就会**使用以前注册的服务提供商来制作一个**，并把它加入注入器中，然后把该服务返回给 Angular。

当所有请求的服务已解析并返回时，Angular 可以用这些服务实例为参数，调用该组件的构造函数。

![image](images/01.04-架构-服务与依赖注入简介/injector-injects.png)

### 提供服务
对于要用到的任何**服务**，你必须**至少注册一个提供商**。
将**服务注册为提供商有三种方式:**
1. **服务在自己的元数据中将自己注册为提供商**，使用Angular CLI中ng g service命令生成的服务会在@injectable()装饰器中把自己注册到根注入器中。让自己随处可用，并且Angular可以通过移除未使用的服务来优化大小

```ts
@Injectable({
  providedIn: 'root',
})
```

2. **使用特定的 NgModule 注册提供商**，该服务的同一个实例将会对该 NgModule 中的所有组件可用。**在@NgModule() 装饰器中的 providers 属性中注册**：

```ts
@NgModule({
  providers: [
   BackendService,
   Logger
 ],
 ...
})
```
3. 在**组件级注册提供商**,**为该组件的每一个新实例提供该服务的一个新实例**。在 @Component() 元数据的 providers 属性中注册服务提供商。

```ts
@Component({
  selector:    'app-hero-list',
  templateUrl: './hero-list.component.html',
  providers:  [ HeroService ]
})
```

