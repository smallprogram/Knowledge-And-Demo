# [返回主目录](Readme.md)<!-- omit in toc --> 

# 目录 <!-- omit in toc --> 


# 单例服务

单例服务是指在应用中只存在一个实例的服务。

# 提供单例服务
在 Angular 中有两种方式来生成单例服务：

- 把 @Injectable() 的 providedIn 属性声明为 root。

- 把该服务包含在 AppModule 或某个只会被 AppModule 导入的模块中。

## 使用 providedIn
从 Angular 6.0 开始，创建单例服务的首选方式就是在那个服务类的 @Injectable 装饰器上把 providedIn 设置为 root。这会告诉 Angular 在应用的根上提供此服务。

```ts
import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root',
})
export class UserService {
}
```

## NgModule 的 providers 数组
在基于 Angular 6.0 以前的版本构建的应用中，服务是注册在 NgModule 的 providers 数组中的，就像这样：
```ts
@NgModule({
  ...
  providers: [UserService],
  ...
})
```

如果这个 NgModule 是根模块 AppModule，此 UserService 就会是单例的，并且在整个应用中都可用。虽然你可能会看到这种形式的代码，但是最好使用在服务自身的 @Injectable() 装饰器上设置 providedIn 属性的形式，因为 Angular 6.0 可以对这些服务进行摇树优化。

# forRoot() 模式

通常，你只需要用 providedIn 提供服务，用 forRoot()/forChild() 提供路由即可。 不过，理解 forRoot() 为何能够确保服务只有单个实例，可以让你学会更深层次的开发知识。