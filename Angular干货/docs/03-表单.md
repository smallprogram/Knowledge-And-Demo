# [返回主目录](Readme.md)<!-- omit in toc --> 

# 目录 <!-- omit in toc --> 


## 简介
Angular内置两种表单：
1. 响应式表单
2. 模板驱动表单

响应式表单扩展能力、复用性、可测试性强。

模板驱动表单使用简单，但是扩展性复用性差。

## 关键性差异

| 相关方面       | 响应式表单           | 模板驱动表单     |
| -------------- | -------------------- | ---------------- |
| 建立(表单模式) | 显示，在组件类中创建 | 隐式，由组件创建 |
| 数据模式       | 结构化               | 非结构化         |
| 可预测性       | 同步                 | 异步             |
| 表单验证       | 函数                 | 指令             |
| 可变性         | 不可变               | 可变             |
| 可伸缩性       | 访问底层API          | 在API之上的抽象  |

## 共同基础

响应式表单和模板驱动表单都会用到的一些底层模块

- **FormControl** 实例用于追踪单个表单控件的值和验证状态。

- **FormGroup** 用于追踪一个表单控件组的值和状态。

- **FormArray** 用于追踪表单控件数组的值和状态。

- **ControlValueAccessor** 用于在 Angular 的 FormControl 实例和原生 DOM 元素之间创建一个桥梁。

## 响应式表单

### 使用方式
首先在NgModule导入ReactiveFormModule。
```ts
import { ReactiveFormsModule } from '@angular/forms';

@NgModule({
    imports: [
        // other imports ...
        ReactiveFormsModule
    ],
})
export class AppModule { }
```
生成注册表单控件
```ts
import { Component } from '@angular/core';
import { FormControl } from '@angular/forms';

@Component({
  selector: 'app-name-editor',
  templateUrl: './name-editor.component.html',
  styleUrls: ['./name-editor.component.css']
})
export class NameEditorComponent {
  name = new FormControl('');
}

//html
<label>
  Name:
  <input type="text" [formControl]="name">
</label>
```
### 显示替换表单值
模板中显示
```ts
<p>
  Value: {{ name.value }}
</p>
```
组件中替换表单值,可以直接放在方法中
```ts
updateName() {
  this.name.setValue('Nancy');
}
```
### 表单分组
```ts
import { Component } from '@angular/core';
import { FormGroup, FormControl } from '@angular/forms';

@Component({
  selector: 'app-profile-editor',
  templateUrl: './profile-editor.component.html',
  styleUrls: ['./profile-editor.component.css']
})
export class ProfileEditorComponent {
  profileForm = new FormGroup({
    firstName: new FormControl(''),
    lastName: new FormControl(''),
  });
//html
<form [formGroup]="profileForm">
  
  <label>
    First Name:
    <input type="text" formControlName="firstName">
  </label>

  <label>
    Last Name:
    <input type="text" formControlName="lastName">
  </label>

</form>
```
### 提交表单
```ts
<form [formGroup]="profileForm" (ngSubmit)="onSubmit()">

<button type="submit" [disabled]="!profileForm.valid">Submit</button>

onSubmit() {
  // TODO: Use EventEmitter with form value
  console.warn(this.profileForm.value);
}
```
### 嵌套表单
```ts
import { Component } from '@angular/core';
import { FormGroup, FormControl } from '@angular/forms';

@Component({
  selector: 'app-profile-editor',
  templateUrl: './profile-editor.component.html',
  styleUrls: ['./profile-editor.component.css']
})
export class ProfileEditorComponent {
  profileForm = new FormGroup({
    firstName: new FormControl(''),
    lastName: new FormControl(''),
    address: new FormGroup({
      street: new FormControl(''),
      city: new FormControl(''),
      state: new FormControl(''),
      zip: new FormControl('')
    })
  });
}
//html
<div formGroupName="address">
  <h3>Address</h3>

  <label>
    Street:
    <input type="text" formControlName="street">
  </label>

  <label>
    City:
    <input type="text" formControlName="city">
  </label>
  
  <label>
    State:
    <input type="text" formControlName="state">
  </label>

  <label>
    Zip Code:
    <input type="text" formControlName="zip">
  </label>
</div>
```
### 更新部分模型
使用 setValue() 方法来为单个控件设置新值。 setValue() 方法会严格遵循表单组的结构，并整体性替换控件的值。

使用 patchValue() 方法可以用对象中所定义的任何属性为表单模型进行替换。
```ts
updateProfile() {
  this.profileForm.patchValue({
    firstName: 'Nancy',
    address: {
      street: '123 Drew Street'
    }
  });
}

//html
<p>
  <button (click)="updateProfile()">Update Profile</button>
</p>
```
### 使用FormBuilder生成表单控件

FormBuilder 服务提供了一些便捷方法来生成表单控件。FormBuilder 在幕后也使用同样的方式来创建和返回这些实例，只是用起来更简单。

#### 使用方式

```ts
import { Component } from '@angular/core';
//导入FormBuilder
import { FormBuilder } from '@angular/forms';

@Component({
  selector: 'app-profile-editor',
  templateUrl: './profile-editor.component.html',
  styleUrls: ['./profile-editor.component.css']
})
export class ProfileEditorComponent {
  profileForm = this.fb.group({
    firstName: [''],
    lastName: [''],
    address: this.fb.group({
      street: [''],
      city: [''],
      state: [''],
      zip: ['']
    }),
  });
  
//   profileForm = new FormGroup({
//     firstName: new FormControl(''),
//     lastName: new FormControl(''),
//     address: new FormGroup({
//         street: new FormControl(''),
//         city: new FormControl(''),
//         state: new FormControl(''),
//         zip: new FormControl('')
//     })
//   });

  //注入FormBuilder
  constructor(private fb: FormBuilder) { }
}
```
