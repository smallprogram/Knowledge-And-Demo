# [返回主目录](Readme.md)

# 目录 <!-- omit in toc --> 


## 显示数据

- **使用插值显示组件属性**,如果组件中具有一个value的属性，可以通过如下方式将其值显示到模板中。
  ```ts
  {{value}} //value可以时一个表达式，例如1+1，会输出结果2
  ```

- **使用ngFor显示数组属性**，如果组件中有一个数组values属性，可以通过如下方式显示到模板中
  ```ts
  <li *ngFor="let value of values">
  {{ value }}
  </li>
  ```
  这其中 **value叫做模板变量**

  <br>

- **使用强类型数据显示**，可以为数据定义一个类，再定义一个该类的数组，用于展示这种数据的集合。
  ```ts
  //定义一个类
  export class Hero {
  constructor(
    public id: number,
    public name: string) { }
  }

  //定义一个该类型数据的数组
  heroes = [
  new Hero(1, 'Windstorm'),
  new Hero(13, 'Bombasto'),
  new Hero(15, 'Magneta'),
  new Hero(20, 'Tornado')
  ];

  //在模板中展示
  <ul>
    <li *ngFor="let hero of heroes">
      {{ hero.name }}
    </li>
  </ul>
  ```
- **使用NgIf进行条件显示**。在达到某种条件的情况下显示数据。例如：
  ```html
  <p *ngIf="heroes.length > 3">There are many heroes!</p>
  ```

## 模板语法

模板中禁止`<script>`标签，写了也没用。

1. **插值表达式**

    插值格式为`{{value}}`的格式，双括号内可以为组件属性、表达式。可将其用在元素或指令的属性上。
2. **模板表达式**
   模板表达式的意思为花括号之间可以进行简单的运算，例如四则运算。在属性绑定中，模板表达式会出现在等号的右侧的引号中。例如`[property]="expression"`。
3. **表达式上下文**
   表达式上下文最典型的就是组件，他是数据的来源。也可以是模板变量。例如let 后声明的变量，或使用#声明的模板引用变量，例如：
   ```html
   // let后为模板输入变量
   <ul>
    <li *ngFor="let customer of customers">{{customer.name}}</li>
   </ul>
   // #后为模板引用变量
   <label>Type something:
    <input #customerInput>{{customerInput.value}}
   </label>
   ```
4. **模板语句**
   模板语句用来响应由绑定目标（如 HTML 元素、组件或指令）触发的事件。例如`(event)="statement"`，其中等号右边的就是模板语句。
5. **模板语句上下文**
   模板语句上下文一般指正在绑定事件的组件的实例。
   模板上下文中包含模板变量(模板输入变量和模板引用变量)与组件变量。默认模板上下文中模板变量名优先级高于组件上下文中的变量名。

### 绑定语法

分为三类：
- **从数据源到视图**
- **从视图到数据源**
- **双向：视图到数据源到视图**

| 数据方向                 | 语法                                                                        | 绑定类型                   |
| ------------------------ | --------------------------------------------------------------------------- | -------------------------- |
| 单向从数据源到视图       | `{{expression}}`<br> `[target]="expression"`<br> `bind-target="expression"` | 插值、属性Attribute、CSS类 |
| 从视图到数据源的单向绑定 | `(target)="statement"`<br>`on-target="statement"`                           | 事件                       |
| 双向                     | `[(target)]="expression"`<br>`bindon-target="expression"`                   | 双向                       |

#### HTML数据绑定

HTML中一般使用字符串常量设置元素的Attribute，而HTML数据绑定是绑定到DOM的Property上。

有些HTML Attribute与DOM Property是一样的，有些Attribute没有对应的property，有些Dom的Property没有对应Attribute。

总之，模板绑定是绑定的DOM的Property和事件，不是attribute。

[这个网站展示了所有DOM相关的内容](https://developer.mozilla.org/zh-CN/docs/Web/API)。可以参考使用。

#### 绑定类型与绑定目标

数据绑定的目标是DOM中的对象。绑定类型是该对象的Property、事件。有时也会是Attribute。

| 绑定类型  | 目标                                                  | 范例                                                                                                                                                                             |
| --------- | ----------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 属性      | 元素的 property<br>组件的 property<br>指令的 property | `<img [src]="heroImageUrl">`<br>`<app-hero-detail[hero]="currentHero"></app-hero-detail>`<br>`<div [ngClass]="{'special': isSpecial}"></div>`                                    |
| 事件      | 元素的事件<br>组件的事件<br>指令的事件                | `<button (click)="onSave()">Save</button>`<br>`<app-hero-detail (deleteRequest)="deleteHero()"></app-hero-detail>`<br>`<div (myClick)="clicked=$event" clickable>click me</div>` |
| 双向      | 事件与property                                        | `<input [(ngModel)]="name">`                                                                                                                                                     |
| Attribute | attribute(例外情况)                                   | `<button [attr.aria-label]="help">help</button>`                                                                                                                                 |
| CSS类     | class property                                        | `<div [class.special]="isSpecial">Special</div>`                                                                                                                                 |
| 样式      | style property                                        | `<button [style.color]="isSpecial ? 'red' : 'green'">`                                                                                                                           |

属性绑定,应该对应数据类型,要字符串给返回字符串,要数字给返回数字,要特定类型的对象给返回特定类型的对象。

有时可能会使用插值表达式代替属性绑定。类如：
```ts
<p><img src="{{itemImageUrl}}"> is the <i>interpolated</i> image.</p>
<p><img [src]="itemImageUrl"> is the <i>property bound</i> image.</p>
```
这一般都是字符串形式的绑定，当用到非字符串类型的绑定时就必须使用属性绑定的形式了。

#### 内容安全
Angular会屏蔽绑定中存在的script脚本，可以放心使用。

#### Attribute、class、style绑定

- **attribute绑定格式**：
`[attr.attrname]="value"`

- **class绑定**
  绑定类型|语法|输入类型|输入值范围
  -|-|-|-
  单个类绑定|`[class.foo]="hasFoo"`|boolean<br>undefined<br>null|true,false
  多个类绑定|`[class]="classExpr"`|string|"class-1 class-2 class-3"
  |||`{[key:string]:string|undefined|null}`|{foo:true,bar:false}
  |||`Array<string>`|['foo','bar']

- **style绑定**
  
  绑定类型|语法|输入类型|输入值范围
  -|-|-|-
  单个样式绑定|`[style.width]="width"`|string<br>undefined<br>null|"100px"
  带单位的单个样式绑定|`[style.width.px]="width"`|number<br>undefined<br>null|100
  多个样式绑定|`[style]="styleExpr"`|string|"width:100px;height:100px"
  |||`{[key:string]:string|undefined|null}`|{width: '100px', height: '100px'}
  |||`Array<string>`|['width', '100px']

**样式绑定优先级**

样式的优先级规则（从高到低）
1. 模板绑定

  - 属性绑定（例如 `<div [class.foo]="hasFoo">` 或 `<div [style.color]="color">`）

  - Map 绑定（例如，`<div [class]="classExpr">` 或 `<div [style]="styleExpr">` ）

  - 静态值（例如 `<div class="foo">` 或 `<div style="color: blue">` ）

2. 指令宿主绑定

- 属性绑定（例如，`host: {'[class.foo]': 'hasFoo'}` 或 `host: {'[style.color]': 'color'}` ）

- Map 绑定（例如， `host: {'[class]': 'classExpr'}` 或者 `host: {'[style]': 'styleExpr'}` ）

- 静态值（例如， `host: {'class': 'foo'}` 或 `host: {'style': 'color: blue'}` ）

3. 组件宿主绑定

- 属性绑定（例如， `host: {'[class.foo]': 'hasFoo'}` 或 `host: {'[style.color]': 'color'}` ）

- Map 绑定（例如， `host: {'[class]': 'classExpr'}` 或者 `host: {'[style]': 'styleExpr'}` ）

- 静态值（例如， `host: {'class': 'foo'}` 或 `host: {'style': 'color: blue'}` ）


#### 事件绑定

格式如下：
`(event)="func()"`

例如：
```ts
<button (click)="onSave($event)">Save</button>
```

#### $event和EventEmitter

`$event`是事件对象，如果是DOM事件，类似click、input事件等等，那他就是DOM事件对象，那么这个`$event`就回有类似target、target.value这样的属性供你使用。例如：
```ts
<input [value]="currentItem.name"
       (input)="currentItem.name=$event.target.value" >
```
这个例子种，`$event`就是input事件对象。可以通过`$event.target.value`获取到输入中实时变化的值。

EventEmitter是用来自定义事件的。例如，有两个组件，一个父组件一个子组件。

子组件像这样:
```ts
//html
<span>{{ item.name }}</span>
<button (click)="delete()">Delete</button>

//ts

@Component
{(
  selector:'app-item-detail',
)}

@Output() deleteRequest = new EventEmitter<Item>();

delete() {
  this.deleteRequest.emit(this.item);
}
```
父组件像这样：
```ts
//html
<app-item-detail (deleteRequest)="deleteItem($event)" [item]="currentItem"></app-item-detail>

//ts
  deleteItem(item?: item) {
    this.alert(`Delete ${item ? item.name : 'the hero'}.`);
  }

```

这个例子中，子组件使用EventEmitter自定义了一个输出事件deleterequest事件。并在删除按钮被点击是触发子组件的delete方法。方法中使用自定义的deleterequest.emit()方法将该自定义事件输出，并且将要删除的这个对象当作参数也传递了出去。

在父组件中受到了这个传出的自定义事件，并触发了该自定义事件，进而执行了父组件的deleteItem($event)方法。


#### 双向绑定

双向绑定负责干两件事
1. 设置特定的元素属性。

2. 监听元素的变更事件。

格式：`[(name)]="value"`。例如
```ts
<app-size [(size)]="value"></app-size>
```

其原理其实就是定义了两个属性，一个@input输入属性，一个@output自定义事件输出属性。当value变化时，先通过输入属性改变size属性的值，再通过@output触发自定义事件改变模板上值。

#### 内置指令

内置指令分两种
1. 属性型指令
2. 结构型指令

**属性型指令包括**：
- NgClass,添加或删除一组CSS类。
  ```ts
  <div [ngClass]="isSpecial ? 'special' : ''">This div is special</div>
  <div [ngClass]="currentClasses">This div is initially saveable, unchanged, and special.</div>
  currentClasses =  {
    'saveable': this.canSave,
    'modified': !this.isUnchanged,
    'special':  this.isSpecial
  };

  ```
- NgStyle,添加或删除一组HTML样式。
  ```ts
  <div [ngStyle]="currentStyles">
    This div is initially italic, normal weight, and extra large (24px).
  </div>

  currentStyles = {
    'font-style':  this.canSave      ? 'italic' : 'normal',
    'font-weight': !this.isUnchanged ? 'bold'   : 'normal',
    'font-size':   this.isSpecial    ? '24px'   : '12px'
    }
  ```
- NgModel，在**HTMl表单元素中添加双向绑定**。
  ```ts
  <input [(ngModel)]="currentItem.name" id="example-ngModel">
  ```

**结构型指令包括**：

- Ngif,根据条件，添加或删除DOM中的元素
  ```ts
  <app-item-detail *ngIf="isActive" [item]="item"></app-item-detail>
  ```
- NgFor,循环显示条目，可循环HTML块。
- NgSwitch,
- 
